import maya.cmds as cmds
import maya.mel as mel
import pymel.core as pm

from PySide2 import QtWidgets, QtGui, QtCore, QtUiTools
import os
import imp

from ..import utils


fileName = __name__.split('.')[0]
rootPath = os.path.abspath(imp.find_module(fileName)[1])

def createMainPoser(name=""):
	if not name:
		name, ok = QtWidgets.QInputDialog.getText(None, "Add Poser", "Please enter poser name", QtWidgets.QLineEdit.Normal, "mainPoser")
		
		if ok:
			if cmds.objExists(name):
				QtWidgets.QMessageBox.information(None, "Warning", "This poser is exist.")
				return
	
			if " " in name or "-" in name  or name[0].isdigit():
				QtWidgets.QMessageBox.information(None, "Warning", "Wrong Name.")
				return
		else:
			return
	
	# import
	path = rootPath + '//rigTools//' + 'mainPoser.ma'		
	
	if name == 'mainPoser':
		utils.importFile(path)
		cmds.select("mainPoser")
	else:
		utils.importFile(path, name)
		if cmds.objExists("mainPoser"):
			cmds.parent(name+"_mainPoser", "mainPoser")
		cmds.select(name+"_mainPoser")
		
	return name+"_mainPoser"
		
def createPoser(name=""):
	if not name:
		name, ok = QtWidgets.QInputDialog.getText(None, "Add Poser", "Please enter poser name", QtWidgets.QLineEdit.Normal, "root")
	
		if not cmds.objExists("mainPoser"):
			cmds.warning("mainPoser is not exists")
			return
			
		if ok:
			if cmds.objExists(name+"_poser"):
				QtWidgets.QMessageBox.information(None, "Warning", "This poser is exist.")
				return
	
			if " " in name or "-" in name  or name[0].isdigit():
				QtWidgets.QMessageBox.information(None, "Warning", "Wrong Name.")
				return
		else:
			return
		
	# import
	path = rootPath + '//rigTools//' + 'poser.ma'		
	utils.importFile(path, name)
	
	if cmds.objExists("red_rsMat"):
		cmds.delete(name+"_red_rsMat")
		cmds.select(name+"_poser_axis_x")
		cmds.hyperShade(assign= "red_rsMat")
		cmds.delete(name+"_green_rsMat")
		cmds.select(name+"_poser_axis_y")
		cmds.hyperShade(assign= "green_rsMat")
		cmds.delete(name+"_blue_rsMat")
		cmds.select(name+"_poser_axis_z")
		cmds.hyperShade(assign= "blue_rsMat")
	else:
		cmds.rename(name+"_red_rsMat", "red_rsMat")
		cmds.rename(name+"_green_rsMat", "green_rsMat")
		cmds.rename(name+"_blue_rsMat", "blue_rsMat")
	
	if cmds.objExists("mainPoser"):
		cmds.parent(name+"_poser", "mainPoser")
	cmds.select(name+"_poser")
	
	return name+"_poser"

def connectPosers(src=None, tgt=None, name_m=""):
	if not src:
		sel = cmds.ls(sl=1)
		if len(sel) != 2:
			cmds.warning("Select source and target nodes")
			return
			
		src, tgt = sel	

	if not cmds.objExists(name_m+"lines_group"):
		cmds.group(empty=True, n=name_m+"lines_group")
		cmds.parent(name_m+"lines_group", name_m+"mainPoser")
			
	# import
	path = rootPath + '//rigTools//' + 'line.ma'		
	utils.importFile(path, tgt.split("_poser")[0])
	
	
	line = tgt.replace("poser","line")
	cmds.parent(line, name_m+"lines_group")
	
	cmds.parent(line+"_start_cluster_group", src)
	cmds.parent(line+"_end_cluster_group", tgt)
	utils.resetAttrs(line + "_start_cluster_group")
	utils.resetAttrs(line + "_end_cluster_group")
	
	utils.setUserAttr(src, "lineWidth", 1, type="float", lock=False, keyable=False, cb=True)
	utils.setUserAttr(tgt, "lineWidth", 1, type="float", lock=False, keyable=False, cb=True)
	
	cmds.connectAttr(src+".lineWidth", line+"_start_cluster.sx")
	cmds.connectAttr(src+".lineWidth", line+"_start_cluster.sy")
	cmds.connectAttr(src+".lineWidth", line+"_start_cluster.sz")
	cmds.connectAttr(tgt+".lineWidth", line+"_end_cluster.sx")
	cmds.connectAttr(tgt+".lineWidth", line+"_end_cluster.sy")
	cmds.connectAttr(tgt+".lineWidth", line+"_end_cluster.sz")
	
	if cmds.objExists("black_rsMat"):
		cmds.delete(line+"_rsMat")
		cmds.select(line)
		cmds.hyperShade(assign="black_rsMat")
	else:
		cmds.rename(line+"_rsMat", "black_rsMat")	
		
	try:
		cmds.select(sel)
	except: pass
		
def orientPosers():
	sel = cmds.ls(sl=1)
	if len(sel) != 2:
		cmds.warning("Select source and target nodes")
		return
	
	src, tgt = sel
	
	con = cmds.aimConstraint(tgt, src+"Orient", aimVector=(1,0,0), upVector=(0,1,0), worldUpType="none")[0]
	
	utils.setUserAttr(src, "twist", 0, type="float", lock=False, keyable=True, cb=True)
	cmds.connectAttr(src+".twist", con+".offsetX")
	
	cmds.setAttr(src+".rx", e=1, l=True, keyable=0, cb=0 )
	cmds.setAttr(src+".ry", e=1, l=True, keyable=0, cb=0 )
	cmds.setAttr(src+".rz", e=1, l=True, keyable=0, cb=0 )
	
def createAddPoser(name, moduleName):
	# import
	path = rootPath + '//rigTools//' + 'poser.ma'		
	utils.importFile(path, name)
	
	if cmds.objExists("red_rsMat"):
		cmds.delete(name+"_red_rsMat")
		cmds.select(name+"_poser_axis_x")
		cmds.hyperShade(assign= "red_rsMat")
		cmds.delete(name+"_green_rsMat")
		cmds.select(name+"_poser_axis_y")
		cmds.hyperShade(assign= "green_rsMat")
		cmds.delete(name+"_blue_rsMat")
		cmds.select(name+"_poser_axis_z")
		cmds.hyperShade(assign= "blue_rsMat")
	else:
		cmds.rename(name+"_red_rsMat", "red_rsMat")
		cmds.rename(name+"_green_rsMat", "green_rsMat")
		cmds.rename(name+"_blue_rsMat", "blue_rsMat")
	
	
	cmds.parent(name+"_poser", moduleName+"_mainPoser")
	cmds.select(name+"_poser")	
	
	
	
	cmds.rename(name+"_poser", name+"_addPoser")
	
	cmds.select(name+"_addPoser") 
	
def generateAddPoser(name, moduleName):
	p = name+"_addPoser"
	sph = cmds.sphere(r=0.1, ax=(0,1,0), n=p)
	mel.eval("DeleteHistory")
	
	try:
		conn = cmds.listConnections(name+'_addPoserShape.instObjGroups[0]', plugs=1, d=1, s=0)[0]
		cmds.disconnectAttr(name+'_addPoserShape.instObjGroups[0]', conn)
	except: pass
	
	mel.eval('''
	addAttr -sn "size" -ln "size" -dv 1 -min 0 -at "double";
	addAttr -sn "axises" -ln "axises" -min 0 -max 1 -at "bool";
	setAttr -k off ".v";
	setAttr -k on ".t";
	setAttr -l on -k off ".sx";
	setAttr -l on -k off ".sy";
	setAttr -l on -k off ".sz";
	setAttr -k on ".size";
	setAttr -cb on ".axises" yes;

createNode locator -n "{0}_poser_locShape" -p "{0}_addPoser";
	setAttr -k off ".v";
	setAttr ".ove" yes;
	setAttr ".ovc" 12;
	setAttr ".los" -type "double3" 0.01 0.01 0.01 ;
	
	
createNode transform -n "{0}_poserOrient" -p "{0}_addPoser";
createNode locator -n "{0}_poserOrientShape" -p "{0}_poserOrient";
	setAttr -k off ".v" no;
	setAttr ".ove" yes;
	setAttr ".ovc" 14;
	setAttr ".los" -type "double3" 0.1 0.1 0.1 ;
	
	
createNode transform -n "{0}_poser_axis_y" -p "{0}_poserOrient";
	setAttr -k off ".v";
	setAttr ".ovdt" 2;
	setAttr ".ove" yes;
	setAttr -k on ".t";
	setAttr -l on -k off ".tx";
	setAttr -l on -k off ".ty";
	setAttr -l on -k off ".tz";
	setAttr -k on ".r";
	setAttr -l on -k off ".rx";
	setAttr -l on -k off ".ry";
	setAttr -l on -k off ".rz";
	setAttr -l on -k off ".sx";
	setAttr -l on -k off ".sy";
	setAttr -l on -k off ".sz";
createNode nurbsSurface -n "{0}_poser_axis_yNurbsShape" -p "{0}_poser_axis_y";
	setAttr -k off ".v";
	setAttr ".io" off;
	setAttr ".vir" yes;
	setAttr ".vif" yes;
	setAttr ".covm[0]"  0 1 1;
	setAttr ".cdvm[0]"  0 1 1;
	setAttr ".dvu" 0;
	setAttr ".dvv" 0;
	setAttr ".cpr" 4;
	setAttr ".cps" 4;
	setAttr ".cc" -type "nurbsSurface" 
		3 3 0 2 no 
		9 0 0 0 1 2 3 4 4 4
		13 -2 -1 0 1 2 3 4 5 6 7 8 9 10
		
		77
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		3.0412919280950412e-016 0.12116590880414468 -9.2907238900596404e-018
		0.0073366971563533214 0.12116590880414468 -0.0073366971563530422
		0.010375656621538868 0.12116590880414468 -2.2830399865658042e-018
		0.0073366971563533136 0.12116590880414468 0.0073366971563530422
		3.048336396250022e-016 0.12116590880414468 0.01037565662153855
		-0.007336697156352729 0.12116590880414468 0.0073366971563530422
		-0.010375656621538236 0.12116590880414468 2.0988649979276915e-018
		-0.0073366971563527585 0.12116590880414468 -0.0073366971563530343
		2.9381499299267122e-016 0.12116590880414468 -0.010375656621538573
		0.0073366971563533214 0.12116590880414468 -0.0073366971563530422
		0.010375656621538868 0.12116590880414468 -2.2830399865658042e-018
		0.0073366971563533136 0.12116590880414468 0.0073366971563530422
		0.018881749141304728 0.12116590878528212 -0.018881749141304388
		0.026702825716959561 0.12116590878528212 3.2181310652360572e-018
		0.018881749141304728 0.12116590878528212 0.018881749141304388
		3.1315039216536308e-016 0.12116590878528212 0.026702825716959217
		-0.01888174914130401 0.12116590878528212 0.018881749141304378
		-0.026702825716958825 0.12116590878528212 4.9349467290811812e-018
		-0.01888174914130401 0.12116590878528212 -0.018881749141304333
		2.9435323527445832e-016 0.12116590878528212 -0.026702825716959217
		0.018881749141304728 0.12116590878528212 -0.018881749141304388
		0.026702825716959561 0.12116590878528212 3.2181310652360572e-018
		0.018881749141304728 0.12116590878528212 0.018881749141304388
		0.017749644209096787 0.21861219604402021 -0.017749644209096523
		0.025101787567801816 0.21861219604402021 5.9378961981994384e-018
		0.017749644209096829 0.21861219604402021 0.01774964420909645
		3.1698777713083992e-016 0.21861219604402021 0.02510178756780148
		-0.017749644209096121 0.21861219604402021 0.01774964420909645
		-0.025101787567801161 0.21861219604402021 4.4895761038569445e-018
		-0.017749644209096142 0.21861219604402021 -0.017749644209096395
		3.0237985278080127e-016 0.21861219604402021 -0.02510178756780148
		0.017749644209096787 0.21861219604402021 -0.017749644209096523
		0.025101787567801816 0.21861219604402021 5.9378961981994384e-018
		0.017749644209096829 0.21861219604402021 0.01774964420909645
		0.019046543930097873 0.318315181367466 -0.019046543930097505
		0.026935880742279254 0.318315181367466 9.4972938243272301e-018
		0.019046543930097873 0.318315181367466 0.019046543930097495
		3.0782414831244014e-016 0.318315181367466 0.026935880742278869
		-0.019046543930097141 0.318315181367466 0.019046543930097495
		-0.026935880742278529 0.318315181367466 4.6572074697566926e-018
		-0.019046543930097144 0.318315181367466 -0.019046543930097505
		2.9543482085117956e-016 0.318315181367466 -0.026935880742278869
		0.019046543930097873 0.318315181367466 -0.019046543930097505
		0.026935880742279254 0.318315181367466 9.4972938243272301e-018
		0.019046543930097873 0.318315181367466 0.019046543930097495
		0.006177058326949863 0.31844451537886503 -0.006177058326949569
		0.008735679661542017 0.31844451537886503 6.055080158103478e-018
		0.0061770583269498552 0.31844451537886503 0.006177058326949569
		3.0432537312563868e-016 0.31844451537886503 0.0087356796615417065
		-0.0061770583269492663 0.31844451537886503 0.006177058326949569
		-0.00873567966154137 0.31844451537886503 1.3577188500512061e-018
		-0.0061770583269492663 0.31844451537886503 -0.006177058326949569
		3.0343499660208565e-016 0.31844451537886503 -0.0087356796615417065
		0.006177058326949863 0.31844451537886503 -0.006177058326949569
		0.008735679661542017 0.31844451537886503 6.055080158103478e-018
		0.0061770583269498552 0.31844451537886503 0.006177058326949569
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		3.103366460477189e-016 0.31844451537886503 -5.190779536621407e-019
		
		;
		
createNode transform -n "{0}_poser_axis_z" -p "{0}_poserOrient";
	setAttr -k off ".v";
	setAttr ".ovdt" 2;
	setAttr ".ove" yes;
	setAttr -k on ".t";
	setAttr -l on -k off ".tx";
	setAttr -l on -k off ".ty";
	setAttr -l on -k off ".tz";
	setAttr -k on ".r";
	setAttr -l on -k off ".rx";
	setAttr -l on -k off ".ry";
	setAttr -l on -k off ".rz";
	setAttr -l on -k off ".sx";
	setAttr -l on -k off ".sy";
	setAttr -l on -k off ".sz";
createNode nurbsSurface -n "{0}_poser_axis_zNurbsShape" -p "{0}_poser_axis_z";
	setAttr -k off ".v";
	setAttr ".io" off;
	setAttr ".vir" yes;
	setAttr ".vif" yes;
	setAttr ".covm[0]"  0 1 1;
	setAttr ".cdvm[0]"  0 1 1;
	setAttr ".dvu" 0;
	setAttr ".dvv" 0;
	setAttr ".cpr" 4;
	setAttr ".cps" 4;
	setAttr ".cc" -type "nurbsSurface" 
		3 3 0 2 no 
		9 0 0 0 1 2 3 4 4 4
		13 -2 -1 0 1 2 3 4 5 6 7 8 9 10
		
		77
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		3.0412919280950412e-016 2.7185930690595569e-017 0.12432179981759922
		0.0073366971563533214 0.0073366971563530595 0.12432179981759922
		0.010375656621538868 2.0178246787101809e-017 0.12432179981759922
		0.0073366971563533136 -0.0073366971563530231 0.12432179981759922
		3.048336396250022e-016 -0.010375656621538536 0.12432179981759922
		-0.007336697156352729 -0.0073366971563530231 0.12432179981759922
		-0.010375656621538236 1.5796341802608251e-017 0.12432179981759922
		-0.0073366971563527585 0.0073366971563530465 0.12432179981759922
		2.9381499299267122e-016 0.010375656621538592 0.12432179981759922
		0.0073366971563533214 0.0073366971563530595 0.12432179981759922
		0.010375656621538868 2.0178246787101809e-017 0.12432179981759922
		0.0073366971563533136 -0.0073366971563530231 0.12432179981759922
		0.018881749141304728 0.018881749141304398 0.1243217997991537
		0.026702825716959561 1.4677075733928011e-017 0.1243217997991537
		0.018881749141304728 -0.018881749141304378 0.1243217997991537
		3.1315039216536308e-016 -0.0267028257169592 0.124321799799154
		-0.01888174914130401 -0.018881749141304364 0.1243217997991537
		-0.026702825716958825 1.2960260070082888e-017 0.1243217997991537
		-0.01888174914130401 0.018881749141304343 0.1243217997991537
		2.9435323527445832e-016 0.026702825716959235 0.124321799799154
		0.018881749141304728 0.018881749141304398 0.1243217997991537
		0.026702825716959561 1.4677075733928011e-017 0.1243217997991537
		0.018881749141304728 -0.018881749141304378 0.1243217997991537
		0.017749644209096787 0.017749644209096551 0.21961216175549059
		0.025101787567801816 1.9044614524673549e-017 0.21961216175549059
		0.017749644209096829 -0.017749644209096419 0.21961216175549059
		3.1698777713083992e-016 -0.025101787567801463 0.21961216175549059
		-0.017749644209096121 -0.017749644209096419 0.21961216175549059
		-0.025101787567801161 2.0492934619015983e-017 0.21961216175549059
		-0.017749644209096142 0.017749644209096416 0.21961216175549059
		3.0237985278080127e-016 0.025101787567801501 0.21961216175549059
		0.017749644209096787 0.017749644209096551 0.21961216175549059
		0.025101787567801816 1.9044614524673549e-017 0.21961216175549059
		0.017749644209096829 -0.017749644209096419 0.21961216175549059
		0.019046543930097873 0.019046543930097536 0.31710929404101551
		0.026935880742279254 2.2736651293497414e-017 0.31710929404101551
		0.019046543930097873 -0.01904654393009747 0.31710929404101551
		3.0782414831244014e-016 -0.026935880742278841 0.31710929404101551
		-0.019046543930097141 -0.01904654393009747 0.31710929404101551
		-0.026935880742278529 2.7576737648067921e-017 0.31710929404101551
		-0.019046543930097144 0.019046543930097536 0.31710929404101551
		2.9543482085117956e-016 0.026935880742278904 0.31710929404101551
		0.019046543930097873 0.019046543930097536 0.31710929404101551
		0.026935880742279254 2.2736651293497414e-017 0.31710929404101551
		0.019046543930097873 -0.01904654393009747 0.31710929404101551
		0.006177058326949863 0.0061770583269496054 0.31723576663536562
		0.008735679661542017 2.6188271469422357e-017 0.31723576663536562
		0.0061770583269498552 -0.0061770583269495387 0.31723576663536562
		3.0432537312563868e-016 -0.0087356796615416666 0.31723576663536562
		-0.0061770583269492663 -0.0061770583269495387 0.31723576663536562
		-0.00873567966154137 3.0885632777474648e-017 0.31723576663536562
		-0.0061770583269492663 0.0061770583269496054 0.31723576663536562
		3.0343499660208565e-016 0.0087356796615417377 0.31723576663536562
		0.006177058326949863 0.0061770583269496054 0.31723576663536562
		0.008735679661542017 2.6188271469422357e-017 0.31723576663536562
		0.0061770583269498552 -0.0061770583269495387 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		3.103366460477189e-016 3.2762429581188028e-017 0.31723576663536562
		
		;
createNode transform -n "{0}_poser_axis_x" -p "{0}_poserOrient";
	setAttr -k off ".v";
	setAttr ".ovdt" 2;
	setAttr ".ove" yes;
	setAttr -k on ".t";
	setAttr -l on -k off ".tx";
	setAttr -l on -k off ".ty";
	setAttr -l on -k off ".tz";
	setAttr -k on ".r";
	setAttr -l on -k off ".rx";
	setAttr -l on -k off ".ry";
	setAttr -l on -k off ".rz";
	setAttr -l on -k off ".sx";
	setAttr -l on -k off ".sy";
	setAttr -l on -k off ".sz";
createNode nurbsSurface -n "{0}_poser_axis_xNurbsShape" -p "{0}_poser_axis_x";
	setAttr -k off ".v";
	setAttr ".io" off;
	setAttr ".vir" yes;
	setAttr ".vif" yes;
	setAttr ".covm[0]"  0 1 1;
	setAttr ".cdvm[0]"  0 1 1;
	setAttr ".dvu" 0;
	setAttr ".dvv" 0;
	setAttr ".cpr" 4;
	setAttr ".cps" 4;
	setAttr ".cc" -type "nurbsSurface" 
		3 3 0 2 no 
		9 0 0 0 1 2 3 4 4 4
		13 -2 -1 0 1 2 3 4 5 6 7 8 9 10
		
		77
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.1211659088041447 -2.9155217942891956e-016 -9.2907238900596404e-018
		0.12116590880414468 -0.0073366971563533171 -0.0073366971563530422
		0.12116590880414468 -0.010375656621538868 -2.2830399865658042e-018
		0.12116590880414468 -0.0073366971563533058 0.0073366971563530422
		0.1211659088041447 -2.9155217942891956e-016 0.01037565662153855
		0.12116590880414468 0.0073366971563527525 0.0073366971563530422
		0.1211659088041447 0.010375656621538233 2.0988649979276915e-018
		0.12116590880414468 0.0073366971563527672 -0.0073366971563530343
		0.12116590880414468 -2.8229655468514382e-016 -0.010375656621538573
		0.12116590880414468 -0.0073366971563533171 -0.0073366971563530422
		0.12116590880414468 -0.010375656621538868 -2.2830399865658042e-018
		0.12116590880414468 -0.0073366971563533058 0.0073366971563530422
		0.12116590878528218 -0.018881749141304735 -0.018881749141304388
		0.12116590878528212 -0.026702825716959561 3.2181310652360572e-018
		0.12116590878528218 -0.018881749141304735 0.018881749141304388
		0.12116590878528204 -2.9155217942891956e-016 0.026702825716959217
		0.12116590878528212 0.018881749141304013 0.018881749141304378
		0.12116590878528212 0.026702825716958839 4.9349467290811812e-018
		0.12116590878528212 0.018881749141304013 -0.018881749141304333
		0.12116590878528212 -2.9155217942891956e-016 -0.026702825716959217
		0.12116590878528218 -0.018881749141304735 -0.018881749141304388
		0.12116590878528212 -0.026702825716959561 3.2181310652360572e-018
		0.12116590878528218 -0.018881749141304735 0.018881749141304388
		0.21861219604402021 -0.017749644209096804 -0.017749644209096523
		0.21861219604402021 -0.02510178756780182 5.9378961981994384e-018
		0.21861219604402021 -0.017749644209096804 0.01774964420909645
		0.21861219604402021 -2.9617999180080705e-016 0.02510178756780148
		0.21861219604402021 0.017749644209096128 0.01774964420909645
		0.21861219604402021 0.025101787567801164 4.4895761038569445e-018
		0.21861219604402021 0.017749644209096145 -0.017749644209096395
		0.21861219604402021 -2.9617999180080705e-016 -0.02510178756780148
		0.21861219604402021 -0.017749644209096804 -0.017749644209096523
		0.21861219604402021 -0.02510178756780182 5.9378961981994384e-018
		0.21861219604402021 -0.017749644209096804 0.01774964420909645
		0.318315181367466 -0.019046543930097873 -0.019046543930097505
		0.318315181367466 -0.026935880742279188 9.4972938243272301e-018
		0.318315181367466 -0.019046543930097873 0.019046543930097495
		0.318315181367466 -2.9617999180080705e-016 0.026935880742278869
		0.318315181367466 0.019046543930097207 0.019046543930097495
		0.31831518136746612 0.026935880742278533 4.6572074697566926e-018
		0.318315181367466 0.019046543930097207 -0.019046543930097505
		0.318315181367466 -2.9617999180080705e-016 -0.026935880742278869
		0.318315181367466 -0.019046543930097873 -0.019046543930097505
		0.318315181367466 -0.026935880742279188 9.4972938243272301e-018
		0.318315181367466 -0.019046543930097873 0.019046543930097495
		0.31844451537886503 -0.0061770583269498492 -0.006177058326949569
		0.31844451537886498 -0.0087356796615420569 6.055080158103478e-018
		0.31844451537886503 -0.0061770583269498492 0.006177058326949569
		0.31844451537886503 -3.1469124128835764e-016 0.0087356796615417065
		0.31844451537886503 0.0061770583269492984 0.006177058326949569
		0.31844451537886503 0.008735679661541389 1.3577188500512061e-018
		0.31844451537886503 0.0061770583269492984 -0.006177058326949569
		0.31844451537886503 -3.1469124128835764e-016 -0.0087356796615417065
		0.31844451537886503 -0.0061770583269498492 -0.006177058326949569
		0.31844451537886498 -0.0087356796615420569 6.055080158103478e-018
		0.31844451537886503 -0.0061770583269498492 0.006177058326949569
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		0.31844451537886503 -3.1469124128835764e-016 -5.190779536621407e-019
		
		;
	'''.format(name))
	
	catcher = name+"_addPoser_catcher"
	cmds.polySphere(r=0.1, ax=(0,1,0), n=catcher)
	cmds.parent(catcher, p)
	cmds.setAttr(catcher+".lodVisibility", 0)
	
	cmds.select(name+"_addPoser_catcher")
	mel.eval("DeleteHistory")
	cmds.select(p)
	
	cl, hd = mel.eval("cluster")
	mel.eval("ResetTransformations")
	hd = cmds.rename(hd, name+"_poser_clusterHandle")
	cmds.parent(hd, p)
	cmds.setAttr(hd+"Cluster.relative", 1)
	cmds.setAttr(hd+".v", 0)
	cmds.connectAttr(p+".size", hd+".sx")
	cmds.connectAttr(p+".size", hd+".sy")
	cmds.connectAttr(p+".size", hd+".sz")

	cmds.select(name+"_poser_axis_x")
	cmds.hyperShade(assign= "red_rsMat")
	cmds.select(name+"_poser_axis_y")
	cmds.hyperShade(assign= "green_rsMat")
	cmds.select(name+"_poser_axis_z")
	cmds.hyperShade(assign= "blue_rsMat")	
	
	cmds.connectAttr(name+"_addPoser.axises", name+"_poser_axis_x.v")
	cmds.connectAttr(name+"_addPoser.axises", name+"_poser_axis_y.v")
	cmds.connectAttr(name+"_addPoser.axises", name+"_poser_axis_z.v")
	cmds.connectAttr(hd+".s", name+"_poser_axis_x.s")
	cmds.connectAttr(hd+".s", name+"_poser_axis_y.s")
	cmds.connectAttr(hd+".s", name+"_poser_axis_z.s")
	
	cmds.parent(p, moduleName+"_mainPoser")
	
def reconnectSize():
	sel = pm.ls(sl=1)
	
	for p in sel:
		if p.name().split("_")[-1] != "poser":
			cmds.warning("Selected object is not poser")
			continue
		
		line_clusters = []
		for n in p.lineWidth.outputs():
			if n not in line_clusters:
				if n.name().split("_")[-1] == "cluster":
					line_clusters.append(n)
		
		mult1 = pm.createNode("multDoubleLinear", n=p.name()+"_sizeMult")
		mult2 = pm.createNode("multDoubleLinear", n=p.name()+"_scaleCorrect")
		
		p.lineWidth >> mult1.input1
		p.size >> mult1.input2
		mult1.output >> mult2.input1
		mult2.input2.set(0.35)
		
		p.lineWidth.setMax(10)
		
		for cl in line_clusters:
			mult2.output >> cl.sx
			mult2.output >> cl.sy
			mult2.output >> cl.sz
			
def addCatcher():
	pass